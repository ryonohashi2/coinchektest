# セキュリティ運用ルール

## 環境変数管理

### 基本原則
- **APIキーや機密情報は絶対にコードにハードコーディングしない**
- **`.env.local` ファイルは Git にコミットしない**
- **本番環境では Vercel Dashboard で環境変数を設定**

### 環境変数の命名規則
- 外部サービス用: `SERVICE_NAME_API_KEY` 形式
- Next.js公開用: `NEXT_PUBLIC_` プレフィックス
- 内部用: `INTERNAL_` プレフィックス

### ファイル管理
```bash
# 許可されるファイル
.env.local.example  # テンプレート（Git管理対象）

# 禁止されるファイル
.env.local         # 実際の値（Git管理対象外）
.env.production    # 本番用（Git管理対象外）
```

## APIキー取得・管理

### Coincheck API
1. Coincheckアカウントにログイン
2. 「アカウント設定」→「API」でAPIキーを発行
3. 権限は最小限に設定（読み取り専用推奨）
4. `.env.local` に設定

### CoinGecko API
- 無料枠: APIキー不要
- Pro版: APIキーが必要

## コード品質・セキュリティチェック

### 必須チェック項目
- [ ] ESLint エラーがないこと
- [ ] Prettier でフォーマットされていること
- [ ] 機密情報がコードに含まれていないこと
- [ ] 外部入力値のバリデーションが実装されていること

### 禁止事項
- APIキーの直接記述
- console.log での機密情報出力
- 未検証の外部入力値の使用
- 不要な権限の付与

## Git運用ルール

### コミット前チェック
```bash
# Lintチェック
yarn lint

# テスト実行
yarn test

# 機密情報チェック
git diff --cached | grep -i "api_key\|secret\|password"
```

### ブランチ運用
- `main`: 本番環境用
- `develop`: 開発環境用
- `feature/*`: 機能開発用

### プルリクエスト必須項目
- [ ] セキュリティチェック完了
- [ ] テスト通過
- [ ] コードレビュー完了

## インシデント対応

### APIキー漏洩時の対応
1. 該当APIキーを即座に無効化
2. 新しいAPIキーを発行
3. 環境変数を更新
4. Git履歴から機密情報を削除（必要に応じて）

### 報告先
- プロジェクトマネージャー
- シニアエンジニア
- セキュリティ担当者