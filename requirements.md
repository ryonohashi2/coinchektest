# 要件定義書：金融ダッシュボード (Next.js + ISR)

本プロジェクトでは、Coincheck／CoinGecko APIで取得した暗号資産データを、Next.jsを用いて可視化するリアルタイムダッシュボードを構築します。トップページはISRで定期再生成し、個別資産ページはSSGで高速レンダリングを実現します。APIルートでポートフォリオ集計を提供し、Chart.jsまたはRechartsでグラフ描画を行います。

---

## 1. 目的・背景

ユーザーが保有資産の状況を一目で把握できるUIを提供し、資産運用の意思決定を支援します。高速＆SEOに強いNext.jsの機能を活かし、パフォーマンスと検索適性を両立します。将来的な拡張性も考慮し、APIルートによるバックエンド機能を同一プロジェクト内で実装します。

---

## 2. 対象ユーザー・ステークホルダー

- 個人トレーダー：暗号資産の保有状況を可視化したい投資家
- 開発チーム：Next.js／金融API領域の技術習得を狙うエンジニア
- プロジェクトオーナー：要件定義・品質管理を担当

---

## 3. 機能要件

1. トップページ  
   - ポートフォリオ合計評価額表示  
   - 各資産の保有比率をドーナツチャートで可視化  
   - 再生成間隔（ISRの `revalidate`）を設定可能  

2. 個別資産ページ  
   - 選択した資産の価格推移グラフ（日次／週次）  
   - 保有数量・評価額・利益率の表示  
   - SSGでビルド時生成（`getStaticPaths` + `getStaticProps`）  

3. APIルート  
   - `GET /api/portfolio-summary`：集計した保有総額・比率データを返却  
   - `GET /api/assets`：保有資産一覧を返却  
   - `GET /api/assets/[id]`：特定資産の詳細データを返却  

4. グラフ描画  
   - Chart.js または Recharts を用いてレスポンシブ表示  
   - ローディング／エラーハンドリング実装  

---

## 4. 非機能要件

- パフォーマンス  
  - トップページISR：再生成間隔を1〜5分程度に設定  
  - 個別ページSSG：ビルド時間を考慮し、主要銘柄のみ事前生成  

- セキュリティ  
  - APIキーは環境変数で管理  
  - CORS制御／エラーレスポンス整形  

- 運用・拡張性  
  - コンポーネント設計はAtomic Designに準拠  
  - APIルート追加時のフォルダ構成ルールを策定  

---

## 5. データ要件

| データ種別         | 取得元          | 更新頻度       | 格納方法           |
|--------------------|-----------------|----------------|--------------------|
| 資産価格           | CoinGecko API   | リクエスト毎   | キャッシュ可       |
| 保有数量           | Coincheck API   | ユーザー操作   | サーバーキャッシュ |
| ポートフォリオ集計 | 自前ロジック    | ISRタイミング  | メモリ／Edge       |

---

## 6. システムアーキテクチャ

1. Next.js Frontend  
   - ISR/SSG を活用したページレンダリング  

2. APIルート (Next.js 内蔵)  
   - 資産データ集計ロジック  

3. 外部API  
   - Coincheck：保有数量取得  
   - CoinGecko：公開価格取得  

4. デプロイ先  
   - Vercel（CDN配信＋Edge Functions）

---

## 7. 技術スタック

- フレームワーク：Next.js  
- 言語：TypeScript  
- グラフ：Chart.js または Recharts  
- 認証：（要検討）NextAuth.js／JWT  
- CSS：Tailwind CSS または Emotion  
- デプロイ：Vercel

---

## 8. 開発・運用環境

- ローカル開発：Node.js 18.x、Yarn  
- CI/CD：GitHub Actions → Vercel  
- 環境変数管理：Vercel Dashboard／`.env.local`

---

## 9. 今後の検討事項・質問事項

- 認証・ユーザー管理は必要か？  
- ISRの再生成間隔は何分単位にするか？  
- サポート対象の暗号資産銘柄リストを明確化してください。  
- 利用するグラフライブラリの正式決定（Chart.js vs Recharts）  
- カスタムデザイン要件（UI/UX）やブランドガイドライン

---